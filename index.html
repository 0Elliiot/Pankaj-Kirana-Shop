<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pankaj Kirana Store - Pro Max</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-database-compat.js"></script>
    <style>
        .active-cat { background-color: #4338ca !important; color: white !important; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .modal-animate { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    </style>
</head>
<body class="bg-gray-50 pb-24 font-sans text-black">

    <header class="bg-indigo-900 text-white p-3 sticky top-0 shadow-lg flex justify-between items-center z-50">
        <div>
            <h1 class="text-xc font-bold italic">Pankaj Kirana ðŸ›’</h1>
            <p id="user-welcome" class="text-[14px] opacity-80 font-medium">Welcome, Guest</p>
        </div>
        <div class="flex gap-2">
            <button onclick="showTrackModal()" class="text-[10px] bg-indigo-600 px-2 py-1 rounded-full border border-indigo-400 font-bold uppercase">Track Order</button>
            <button id="auth-btn" onclick="toggleAuthModal()" class="text-[11px] bg-white text-indigo-700 px-3 py-1 rounded-full font-bold uppercase">Login</button>
            <button onclick="toggleCart()" class="bg-white text-indigo-700 px-3 py-1 rounded-full font-bold text-sm shadow-md">
                ðŸ›’ (<span id="cart-count">0</span>)
            </button>
        </div>
    </header>

    <div class="p-3 bg-white sticky top-[60px] z-50 shadow-sm">
        <input id="search-box" onkeyup="searchProducts()" type="text" placeholder="Search items (Maggi, Coke...)" class="w-full p-3 border border-indigo-100 rounded-xl outline-none focus:ring-2 focus:ring-indigo-500 bg-gray-50 text-sm">
    </div>

    <div class="flex overflow-x-auto p-4 gap-3 bg-white shadow-sm sticky top-[125px] z-50 scrollbar-hide">
        <button onclick="filterProducts('All', this)" class="cat-btn active-cat bg-gray-100 text-gray-600 px-4 py-1 rounded-full text-xs font-bold whitespace-nowrap">All Items</button>
        <button onclick="filterProducts('Drink', this)" class="cat-btn bg-gray-100 text-gray-600 px-4 py-1 rounded-full text-xs font-bold whitespace-nowrap">Cold Drinks</button>
        <button onclick="filterProducts('Kirana', this)" class="cat-btn bg-gray-100 text-gray-600 px-4 py-1 rounded-full text-xs font-bold whitespace-nowrap">Daily Kirana</button>
        <button onclick="filterProducts('Snacks', this)" class="cat-btn bg-gray-100 text-gray-600 px-4 py-1 rounded-full text-xs font-bold whitespace-nowrap">Snacks</button>
        <button onclick="filterProducts('Personal', this)" class="cat-btn bg-gray-100 text-gray-600 px-4 py-1 rounded-full text-xs font-bold whitespace-nowrap">Personal Care</button>
    </div>

    <main id="product-list" class="p-4 grid grid-cols-2 md:grid-cols-4 gap-4"></main>

    <div id="variant-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden z-[100] flex justify-center items-end text-black">
        <div class="bg-white w-full max-w-lg rounded-t-3xl p-6 shadow-2xl modal-animate">
            <div class="flex justify-between items-center mb-4">
                <h2 id="variant-item-name" class="text-xl font-black text-indigo-700">Select Size</h2>
                <button onclick="closeVariantModal()" class="text-gray-400 text-2xl">&times;</button>
            </div>
            <div id="variant-list" class="space-y-3 mb-6">
                </div>
        </div>
    </div>

    <div id="qr-modal" class="fixed inset-0 bg-black bg-opacity-90 hidden z-[110] flex justify-center items-center p-4 text-black">
        <div class="bg-white w-full max-w-sm rounded-3xl p-6 text-center modal-animate">
            <h2 class="text-xl font-black text-indigo-700 mb-2">Scan & Pay</h2>
            <div class="bg-indigo-50 p-4 rounded-2xl inline-block border-2 border-indigo-100 mb-2">
                <img id="qr-image" src="" alt="UPI QR Code" class="w-48 h-48 mx-auto">
            </div>

            <div onclick="copyUPI()" class="mb-4 bg-gray-100 p-2 rounded-xl border border-dashed border-gray-400 cursor-pointer active:bg-green-100 transition-colors">
                <p class="text-[9px] text-gray-500 font-bold uppercase">Tap to Copy UPI ID</p>
                <p id="upi-id-text" class="text-sm font-black text-indigo-700">8954998216@ptsbi</p>
            </div>

            <div class="text-2xl font-black text-green-600 mb-4">â‚¹<span id="qr-amount-display">0</span></div>
            
            <div class="mb-4 text-left">
                <label class="text-[10px] font-bold text-gray-500 uppercase ml-1">Transaction UTR (12 Digits) *</label>
                <input id="utr-input" type="number" placeholder="Enter UTR Number" class="w-full p-3 border-2 border-indigo-600 rounded-xl outline-none font-bold text-center">
            </div>
            
            <button onclick="confirmQRPayment()" class="w-full bg-green-600 text-white py-4 rounded-2xl font-bold shadow-lg mb-3">Confirm Payment & Order</button>
            <button onclick="toggleQRModal(false)" class="w-full text-gray-400 text-sm font-bold">Cancel</button>
        </div>
    </div>

    <div id="cart-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden z-50 flex justify-center items-end text-black">
        <div class="bg-white w-full max-w-lg rounded-t-3xl p-6 shadow-2xl modal-animate">
            <h2 class="text-2xl font-black mb-4">Your Cart</h2>
            <div id="cart-items" class="space-y-3 mb-6 max-h-40 overflow-y-auto border-b pb-4"></div>
            
            <div class="relative bg-gray-50 border border-dashed border-indigo-200 rounded-2xl p-4 mb-4" id="address-display-box">
                <button onclick="toggleAddressEdit(true)" class="absolute top-3 right-3 text-indigo-600 font-bold text-xs bg-indigo-50 px-3 py-1 rounded-lg border border-indigo-100">EDIT</button>
                <p class="text-[10px] text-gray-400 font-bold uppercase mb-1">Delivery Details</p>
                <p id="disp-name" class="font-bold text-sm">---</p>
                <p id="disp-numbr" class="text-xs text-gray-600">---</p>
                <p id="disp-addr" class="text-xs text-gray-500 mt-1 italic leading-tight">---</p>
            </div>

            <div id="address-edit-form" class="hidden space-y-3 mb-4 bg-white p-3 border rounded-2xl">
                <input id="cust-name" type="text" placeholder="Name" class="w-full p-2 border rounded-xl text-sm outline-none">
                <input id="cust-numbr" type="text" placeholder="Phone" class="w-full p-2 border rounded-xl text-sm outline-none">
                <input id="cust-addr" type="text" placeholder="Address" class="w-full p-2 border rounded-xl text-sm outline-none">
                <button onclick="toggleAddressEdit(false)" class="w-full bg-indigo-100 text-indigo-700 py-2 rounded-xl text-xs font-bold uppercase">Save Changes</button>
            </div>

            <input id="cust-rmrks" type="text" placeholder="Add Note (Optional)" class="w-full p-3 border rounded-xl outline-none mb-4 text-sm">
            
            <div class="flex justify-between items-center py-2 text-xl font-bold border-t">
                <span>Total:</span><span class="text-green-600">â‚¹<span id="cart-total">0</span></span>
            </div>
            
            <div class="grid grid-cols-2 gap-2 mb-2">
                <button onclick="placeOrder()" class="bg-green-600 text-white py-3 rounded-xl font-bold text-sm">WhatsApp (COD)</button>
                <button onclick="openQR()" class="bg-indigo-700 text-white py-3 rounded-xl font-bold text-sm">Pay Online (QR)</button>
            </div>
            <button onclick="toggleCart()" class="w-full mt-2 text-gray-400 text-sm">Continue Shopping</button>
        </div>
    </div>

    <div id="success-modal" class="fixed inset-0 bg-black bg-opacity-80 hidden z-[120] flex justify-center items-center p-4">
        <div class="bg-white w-full max-w-sm rounded-3xl p-8 text-center modal-animate text-black">
            <div class="text-6xl mb-4">âœ…</div>
            <h2 class="text-2xl font-black text-green-600">Order Placed!</h2>
            <p class="text-gray-500 mt-2 italic font-medium">Your Order ID is:</p>
            <div class="bg-gray-100 p-3 rounded-xl mt-2 font-bold text-indigo-700 text-xl" id="final-ord-id">---</div>
            <p class="text-xs text-gray-400 mt-4">Pankaj bhai abhi aapka order check karenge.</p>
            <button onclick="location.reload()" class="w-full bg-indigo-700 text-white py-4 rounded-2xl font-bold mt-6 shadow-lg">Done</button>
        </div>
    </div>

    <div id="auth-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden z-[60] flex justify-center items-center p-4 text-black">
        <div class="bg-white w-full max-w-md rounded-2xl p-6 shadow-2xl">
            <div id="login-form">
                <h2 class="text-2xl font-black mb-1 text-indigo-700">Login</h2>
                <div id="phone-input-section">
                    <input id="login-phone" type="tel" placeholder="Mobile Number" class="w-full p-3 border rounded-xl mb-3 outline-none">
                    <button onclick="sendOTP()" class="w-full bg-indigo-700 text-white py-3 rounded-xl font-bold">Send OTP</button>
                </div>
                <div id="otp-input-section" class="hidden">
                    <input id="login-otp" type="number" placeholder="OTP" class="w-full p-3 border rounded-xl mb-3 text-center text-xl font-bold">
                    <button onclick="verifyOTP()" class="w-full bg-green-600 text-white py-3 rounded-xl font-bold">Verify</button>
                </div>
            </div>
            <div id="register-form" class="hidden">
                <h2 class="text-2xl font-black mb-4 text-indigo-700">Register</h2>
                <input id="reg-name" type="text" placeholder="Name" class="w-full p-3 border rounded-xl mb-2">
                <input id="reg-phone" type="tel" placeholder="Phone" class="w-full p-3 border rounded-xl mb-2">
                <input id="reg-addr" type="text" placeholder="Address" class="w-full p-3 border rounded-xl mb-2">
                <button onclick="handleRegister()" class="w-full bg-green-600 text-white py-3 rounded-xl font-bold">Sign Up</button>
            </div>
            <button onclick="toggleAuthModal()" class="w-full mt-4 text-gray-400 text-xs uppercase">Close</button>
        </div>
    </div>

    <div id="track-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden z-50 flex justify-center items-center p-4 text-black">
        <div class="bg-white w-full max-w-md rounded-2xl p-6">
            <h2 class="text-xl font-bold mb-4 text-center">Track Order</h2>
            <input id="track-id-input" type="text" placeholder="ORD1001" class="w-full p-3 border rounded-xl mb-4 text-center font-bold">
            <button onclick="trackOrder()" class="w-full bg-indigo-600 text-white py-3 rounded-xl font-bold">Check Status</button>
            <div id="track-result" class="mt-4 p-4 bg-indigo-50 rounded-xl hidden text-center">
                <p class="font-bold">Status: <span id="status-text" class="text-indigo-700 uppercase">---</span></p>
            </div>
            <button onclick="showTrackModal()" class="w-full text-gray-400 mt-4 text-xs font-bold underline">Close</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAeG25EZLmrhfedtBwsak0Fd_2Opsa99_g",
            authDomain: "pankaj-kirana-store-38072.firebaseapp.com",
            projectId: "pankaj-kirana-store-38072",
            databaseURL: "https://pankaj-kirana-store-38072-default-rtdb.firebaseio.com",
            storageBucket: "pankaj-kirana-store-38072.firebasestorage.app",
            messagingSenderId: "581034855422",
            appId: "1:581034855422:web:aaf2abecef1c0e7ba60eaf"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        
        const myWhatsApp = "918954998216";
        const myUPI = "8954998216@ptsbi"; 
        const storeName = "Pankaj Kirana Store";

        let currentUser = JSON.parse(localStorage.getItem('pankaj_user')) || null;
        let cart = {};
        let generatedOTP = null;

        // DATA UPDATED WITH VARIANTS
        const products = [
            { id: 1, name: "Coca Cola", img: "ðŸ¥¤", cat: "Drink", 
              variants: [{size: "250ml", price: 20}, {size: "750ml", price: 45}, {size: "1.25L", price: 70}, {size: "2L", price: 95}] 
            },
            { id: 2, name: "Pepsi", img: "ðŸ¥¤", cat: "Drink",
              variants: [{size: "250ml", price: 20}, {size: "750ml", price: 45}, {size: "2L", price: 95}]
            },
            { id: 3, name: "Sprite", img: "ðŸ‹", cat: "Drink",
              variants: [{size: "250ml", price: 20}, {size: "750ml", price: 45}, {size: "2L", price: 95}]
            },
            { id: 4, name: "Thums Up", img: "ðŸ¥¤", cat: "Drink",
              variants: [{size: "250ml", price: 20}, {size: "750ml", price: 45}, {size: "2L", price: 95}]
            },
            { id: 5, name: "Maaza", img: "ðŸ¥­", cat: "Drink",
              variants: [{size: "150ml", price: 10}, {size: "600ml", price: 40}, {size: "1.2L", price: 75}]
            },
            { id: 6, name: "Sting Energy", price: 20, img: "âš¡", cat: "Drink" },
            { id: 7, name: "Mountain Dew", img: "ðŸ", cat: "Drink",
              variants: [{size: "250ml", price: 20}, {size: "750ml", price: 45}, {size: "1L", price: 60}, {size: "2L", price: 95}]
            },
            { id: 11, name: "Fortune Oil", img: "ðŸ¶", cat: "Kirana",
              variants: [{size: "500ml", price: 85}, {size: "1L", price: 160}, {size: "5L", price: 780}]
            },
            { id: 12, name: "Aashirvaad Atta", img: "ðŸŒ¾", cat: "Kirana",
              variants: [{size: "1kg", price: 55}, {size: "5kg", price: 255}, {size: "10kg", price: 490}]
            },
            { id: 13, name: "Tata Salt 1kg", price: 28, img: "ðŸ§‚", cat: "Kirana" },
            { id: 14, name: "Sugar", img: "ðŸ¬", cat: "Kirana",
              variants: [{size: "1kg", price: 45}, {size: "5kg", price: 220}]
            },
            { id: 26, name: "Maggi", img: "ðŸœ", cat: "Snacks",
              variants: [{size: "Single", price: 14}, {size: "4-Pack", price: 56}, {size: "12-Pack", price: 160}]
            },
            { id: 27, name: "Kurkure Masala", price: 10, img: "ðŸ¿", cat: "Snacks" },
            { id: 28, name: "Lays Blue", price: 10, img: "ðŸŸ", cat: "Snacks" },
            { id: 41, name: "Dettol Soap", price: 35, img: "ðŸ§¼", cat: "Personal" },
            { id: 46, name: "Surf Excel", img: "ðŸ§º", cat: "Personal",
              variants: [{size: "500g", price: 75}, {size: "1kg", price: 140}]
            }
        ];

        function renderProducts(list = products) {
            const container = document.getElementById('product-list');
            container.innerHTML = list.map(p => {
                // Displaying price or price range
                let priceDisplay = p.price ? `â‚¹${p.price}` : `â‚¹${p.variants[0].price}+`;
                return `
                <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 text-center flex flex-col justify-between">
                    <div>
                        <div class="text-4xl mb-2">${p.img}</div>
                        <h3 class="font-bold text-gray-800 text-xs h-8 overflow-hidden">${p.name}</h3>
                        <p class="text-indigo-600 font-bold">${priceDisplay}</p>
                    </div>
                    <button onclick="handleAddToCart(${p.id})" class="mt-3 w-full bg-indigo-50 text-indigo-700 py-2 rounded-xl font-bold border border-indigo-100">+ Add</button>
                </div>
            `}).join('');
        }

        // NEW LOGIC FOR VARIANTS
        function handleAddToCart(id) {
            const p = products.find(i => i.id === id);
            if(p.variants) {
                document.getElementById('variant-item-name').innerText = p.name;
                const vList = document.getElementById('variant-list');
                vList.innerHTML = p.variants.map(v => `
                    <button onclick="addVariantToCart(${p.id}, '${v.size}', ${v.price})" class="w-full flex justify-between items-center p-4 bg-gray-50 rounded-2xl border border-gray-100 active:bg-indigo-50 transition-all">
                        <span class="font-bold text-gray-700">${v.size}</span>
                        <span class="font-black text-indigo-700">â‚¹${v.price}</span>
                    </button>
                `).join('');
                document.getElementById('variant-modal').classList.remove('hidden');
            } else {
                addToCart(p.id, p.name, p.price);
            }
        }

        function addVariantToCart(id, size, price) {
            const p = products.find(i => i.id === id);
            const fullName = `${p.name} (${size})`;
            const cartKey = id + "_" + size; // Unique key for different sizes
            
            if (cart[cartKey]) {
                cart[cartKey].qty++;
            } else {
                cart[cartKey] = { id: cartKey, name: fullName, price: price, qty: 1 };
            }
            
            closeVariantModal();
            updateCart();
        }

        function addToCart(id, name, price) {
            if (cart[id]) cart[id].qty++;
            else { cart[id] = { id, name, price, qty: 1 }; }
            updateCart();
        }

        function closeVariantModal() { document.getElementById('variant-modal').classList.add('hidden'); }

        function searchProducts() {
            const q = document.getElementById('search-box').value.toLowerCase();
            const filtered = products.filter(p => p.name.toLowerCase().includes(q));
            renderProducts(filtered);
        }

        function filterProducts(cat, btn) {
            document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active-cat'));
            btn.classList.add('active-cat');
            renderProducts(cat === 'All' ? products : products.filter(p => p.cat === cat));
        }

        function updateCart() {
            let total = 0, count = 0;
            const itemsDiv = document.getElementById('cart-items');
            itemsDiv.innerHTML = "";
            Object.values(cart).forEach(item => {
                total += item.price * item.qty; count += item.qty;
                itemsDiv.innerHTML += `<div class="flex justify-between items-center text-sm py-2 border-b"><div class="w-1/2"><b>${item.name}</b><br>â‚¹${item.price}</div><div class="flex items-center gap-2"><button onclick="changeQty('${item.id}', -1)" class="w-6 h-6 bg-gray-100 rounded-full font-black">-</button><span class="w-4 text-center font-bold">${item.qty}</span><button onclick="changeQty('${item.id}', 1)" class="w-6 h-6 bg-gray-100 rounded-full font-black">+</button></div></div>`;
            });
            document.getElementById('cart-count').innerText = count;
            document.getElementById('cart-total').innerText = total;
        }

        function changeQty(id, delta) {
            cart[id].qty += delta;
            if (cart[id].qty <= 0) delete cart[id];
            updateCart();
        }

        function toggleCart() { 
            if(!currentUser) { toggleAuthModal(); return; }
            document.getElementById('cart-modal').classList.toggle('hidden'); 
            updateUI(); 
        }

        function openQR() {
            const total = document.getElementById('cart-total').innerText;
            if(total == "0") return;
            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=upi://pay?pa=${myUPI}%26pn=${storeName}%26am=${total}%26cu=INR`;
            document.getElementById('qr-image').src = qrUrl;
            document.getElementById('qr-amount-display').innerText = total;
            document.getElementById('qr-modal').classList.remove('hidden');
        }

        function copyUPI() {
            const upi = document.getElementById('upi-id-text').innerText;
            navigator.clipboard.writeText(upi).then(() => { alert("UPI ID Copied: " + upi); });
        }

        function toggleQRModal(show) { document.getElementById('qr-modal').classList.toggle('hidden', !show); }

        function confirmQRPayment() {
            const utr = document.getElementById('utr-input').value;
            if(utr.length < 10) { alert("Please enter a valid 12-digit UTR Number!"); return; }
            toggleQRModal(false);
            finalSubmit("Online-Paid-QR", utr);
        }

        function placeOrder() { finalSubmit("COD-Pending", "N/A"); }

        function finalSubmit(payStatus, utrValue = "N/A") {
            const name = document.getElementById('cust-name').value;
            const addr = document.getElementById('cust-addr').value;
            const phone = document.getElementById('cust-numbr').value;
            const total = document.getElementById('cart-total').innerText;
            const items = Object.values(cart);
            const rmrks = document.getElementById('cust-rmrks').value;

            if(!name || !addr || items.length === 0) { alert("Details ya cart empty hai!"); return; }

            db.ref('last_order_id').transaction(v => (v || 1000) + 1, (err, comm, snap) => {
                if(comm) {
                    const id = "ORD" + snap.val();
                    const orderData = { id, name, address: addr, phone, items, total, status: "Pending", payment: payStatus, utr: utrValue, timestamp: Date.now() };
                    
                    db.ref('orders/' + id).set(orderData).then(() => {
                        document.getElementById('cart-modal').classList.add('hidden');
                        document.getElementById('final-ord-id').innerText = id;
                        document.getElementById('success-modal').classList.remove('hidden');
                        
                        let str = ""; items.forEach(i => str += `- ${i.name} [x${i.qty}]%0A`);
                        const msg = `*ORDER: ${id}*%0A*Status:* ${payStatus}%0A*UTR:* ${utrValue}%0A*Customer:* ${name}%0A*Phone:* ${phone}%0A*Total:* â‚¹${total}%0A%0A*Items:*%0A${str}%0A*Note:* ${rmrks}`;
                        
                        cart = {}; updateCart();
                        setTimeout(() => { window.location.href = `whatsapp://send?phone=${myWhatsApp}&text=${msg}`; }, 2500);
                    });
                }
            });
        }

        function toggleAuthModal() { document.getElementById('auth-modal').classList.toggle('hidden'); }
        
        function sendOTP() {
            const phone = document.getElementById('login-phone').value;
            if(phone.length < 10) { alert("Sahi number daalein bhai!"); return; }
            db.ref('users/' + phone).once('value', s => {
                if(s.exists()) {
                    generatedOTP = Math.floor(1000 + Math.random() * 9000);
                    alert("Your unique OTP is: " + generatedOTP); 
                    document.getElementById('phone-input-section').classList.add('hidden');
                    document.getElementById('otp-input-section').classList.remove('hidden');
                } else {
                    document.getElementById('login-form').classList.add('hidden');
                    document.getElementById('register-form').classList.remove('hidden');
                    document.getElementById('reg-phone').value = phone;
                }
            });
        }

        function verifyOTP() {
            const entered = document.getElementById('login-otp').value;
            if(entered == generatedOTP) {
                db.ref('users/' + document.getElementById('login-phone').value).once('value', s => {
                    loginUser(s.val());
                    toggleAuthModal();
                });
            } else { alert("Please enter correct OTP !"); }
        }

        function handleRegister() {
            const name = document.getElementById('reg-name').value, 
                  phone = document.getElementById('reg-phone').value, 
                  addr = document.getElementById('reg-addr').value;
            if(!name || !phone || !addr) { alert("Saari details bharo!"); return; }
            db.ref('users/' + phone).set({ name, phone, address: addr }).then(() => {
                loginUser({ name, phone, address: addr });
                toggleAuthModal();
            });
        }

        function loginUser(user) { currentUser = user; localStorage.setItem('pankaj_user', JSON.stringify(user)); updateUI(); }

        function updateUI() {
            if(currentUser) {
                document.getElementById('user-welcome').innerText = "Welcome, " + currentUser.name;
                document.getElementById('auth-btn').innerText = "Logout";
                document.getElementById('auth-btn').onclick = () => { localStorage.clear(); location.reload(); };
                document.getElementById('disp-name').innerText = currentUser.name;
                document.getElementById('disp-numbr').innerText = currentUser.phone;
                document.getElementById('disp-addr').innerText = currentUser.address;
                document.getElementById('cust-name').value = currentUser.name;
                document.getElementById('cust-numbr').value = currentUser.phone;
                document.getElementById('cust-addr').value = currentUser.address;
            }
        }

        function toggleAddressEdit(show) { document.getElementById('address-display-box').classList.toggle('hidden', show); document.getElementById('address-edit-form').classList.toggle('hidden', !show); }
        function showTrackModal() { document.getElementById('track-modal').classList.toggle('hidden'); }
        function trackOrder() {
            const id = document.getElementById('track-id-input').value.toUpperCase();
            db.ref('orders/' + id).once('value', s => {
                if(s.exists()) { document.getElementById('status-text').innerText = s.val().status; document.getElementById('track-result').classList.remove('hidden'); }
                else { alert("Order ID nahi mili!"); }
            });
        }

        renderProducts();
        updateUI();
    </script>
</body>
</html>
