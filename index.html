<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pankaj Kirana Store - Pro Max</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-database-compat.js"></script>
    <style>
        .active-cat { background-color: #4338ca !important; color: white !important; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .modal-animate { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    </style>
</head>
<body class="bg-gray-50 pb-24 font-sans text-black">

    <header class="bg-indigo-900 text-white p-3 sticky top-0 shadow-lg flex justify-between items-center z-50">
        <div>
            <h1 class="text-xc font-bold italic">Pankaj Kirana ğŸ›’</h1>
            <p id="user-welcome" class="text-[14px] opacity-80 font-medium">Welcome, Guest</p>
        </div>
        <div class="flex gap-2">
            <button onclick="showTrackModal()" class="text-[10px] bg-indigo-600 px-2 py-1 rounded-full border border-indigo-400 font-bold uppercase">Track Order</button>
            <button id="auth-btn" onclick="toggleAuthModal()" class="text-[11px] bg-white text-indigo-700 px-3 py-1 rounded-full font-bold uppercase">Login</button>
            <button onclick="toggleCart()" class="bg-white text-indigo-700 px-3 py-1 rounded-full font-bold text-sm shadow-md">
                ğŸ›’ (<span id="cart-count">0</span>)
            </button>
        </div>
    </header>

    <div class="flex overflow-x-auto p-4 gap-3 bg-white shadow-sm sticky top-[60px] z-50 scrollbar-hide">
        <button onclick="filterProducts('All', this)" class="cat-btn active-cat bg-gray-100 text-gray-600 px-4 py-1 rounded-full text-xs font-bold whitespace-nowrap">All Items</button>
        <button onclick="filterProducts('Drink', this)" class="cat-btn bg-gray-100 text-gray-600 px-4 py-1 rounded-full text-xs font-bold whitespace-nowrap">Cold Drinks</button>
        <button onclick="filterProducts('Kirana', this)" class="cat-btn bg-gray-100 text-gray-600 px-4 py-1 rounded-full text-xs font-bold whitespace-nowrap">Daily Kirana</button>
        <button onclick="filterProducts('Snacks', this)" class="cat-btn bg-gray-100 text-gray-600 px-4 py-1 rounded-full text-xs font-bold whitespace-nowrap">Snacks</button>
        <button onclick="filterProducts('Personal', this)" class="cat-btn bg-gray-100 text-gray-600 px-4 py-1 rounded-full text-xs font-bold whitespace-nowrap">Personal Care</button>
    </div>

    <main id="product-list" class="p-4 grid grid-cols-2 md:grid-cols-4 gap-4"></main>

    <div id="auth-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden z-[60] flex justify-center items-center p-4 text-black">
        <div class="bg-white w-full max-w-md rounded-2xl p-6 shadow-2xl">
            <div id="login-form">
                <h2 class="text-2xl font-black mb-1 text-indigo-700">Login</h2>
                <p class="text-xs text-gray-500 mb-4">Verification code will be sent to your phone</p>
                <div id="phone-input-section">
                    <input id="login-phone" type="tel" placeholder="Mobile Number" class="w-full p-3 border rounded-xl mb-3 outline-none focus:ring-2 focus:ring-indigo-500">
                    <button onclick="sendOTP()" class="w-full bg-indigo-700 text-white py-3 rounded-xl font-bold">Send OTP</button>
                </div>
                <div id="otp-input-section" class="hidden">
                    <input id="login-otp" type="number" placeholder="Enter 4 Digit OTP" class="w-full p-3 border rounded-xl mb-3 outline-none text-center text-xl tracking-widest font-bold">
                    <button onclick="verifyOTP()" class="w-full bg-green-600 text-white py-3 rounded-xl font-bold">Verify & Login</button>
                </div>
                <p class="text-sm text-center mt-4">You Don't Have Account? <button onclick="switchAuth(true)" class="text-indigo-700 font-bold underline">Register yourself</button></p>
            </div>
            <div id="register-form" class="hidden">
                <h2 class="text-2xl font-black mb-4 text-indigo-700">Register</h2>
                <div class="space-y-3">
                    <input id="reg-name" type="text" placeholder="Full Name" class="w-full p-3 border rounded-xl outline-none">
                    <input id="reg-phone" type="tel" placeholder="Mobile Number" class="w-full p-3 border rounded-xl outline-none">
                    <input id="reg-email" type="email" placeholder="Email Address" class="w-full p-3 border rounded-xl outline-none">
                    <input id="reg-addr" type="text" placeholder="Complete Address" class="w-full p-3 border rounded-xl outline-none">
                </div>
                <button onclick="handleRegister()" class="w-full bg-green-600 text-white py-3 rounded-xl font-bold mt-4">Sign Up</button>
                <p class="text-sm text-center mt-3">Already Register? <button onclick="switchAuth(false)" class="text-indigo-700 font-bold underline">Login</button></p>
            </div>
            <button onclick="toggleAuthModal()" class="w-full mt-4 text-gray-400 text-xs uppercase font-bold">Close</button>
        </div>
    </div>

    <div id="cart-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden z-50 flex justify-center items-end text-black">
        <div class="bg-white w-full max-w-lg rounded-t-3xl p-6 shadow-2xl modal-animate">
            <h2 class="text-2xl font-black mb-4">Your Cart</h2>
            <div id="cart-items" class="space-y-3 mb-6 max-h-40 overflow-y-auto border-b pb-4"></div>
            
            <div class="relative bg-gray-50 border border-dashed border-indigo-200 rounded-2xl p-4 mb-4" id="address-display-box">
                <button onclick="toggleAddressEdit(true)" class="absolute top-3 right-3 text-indigo-600 font-bold text-xs bg-indigo-50 px-3 py-1 rounded-lg border border-indigo-100">EDIT</button>
                <p class="text-[10px] text-gray-400 font-bold uppercase mb-1">Delivery Details</p>
                <p id="disp-name" class="font-bold text-sm">---</p>
                <p id="disp-numbr" class="text-xs text-gray-600">---</p>
                <p id="disp-addr" class="text-xs text-gray-500 mt-1 italic leading-tight">---</p>
            </div>

            <div id="address-edit-form" class="hidden space-y-3 mb-4 bg-white p-3 border rounded-2xl">
                <input id="cust-name" type="text" placeholder="Name" class="w-full p-2 border rounded-xl text-sm outline-none">
                <input id="cust-numbr" type="text" placeholder="Phone" class="w-full p-2 border rounded-xl text-sm outline-none">
                <input id="cust-addr" type="text" placeholder="Address" class="w-full p-2 border rounded-xl text-sm outline-none">
                <button onclick="toggleAddressEdit(false)" class="w-full bg-indigo-100 text-indigo-700 py-2 rounded-xl text-xs font-bold uppercase">Save Changes</button>
            </div>

            <input id="cust-rmrks" type="text" placeholder="Add Note (Optional)" class="w-full p-3 border rounded-xl outline-none mb-4 text-sm">
            
            <div class="flex justify-between items-center py-2 text-xl font-bold border-t">
                <span>Total:</span><span class="text-green-600">â‚¹<span id="cart-total">0</span></span>
            </div>
            <button onclick="placeOrder()" class="w-full bg-green-600 text-white py-4 rounded-2xl font-bold text-lg shadow-md active:scale-95 transition-all">Confirm Your Order on WhatsApp</button>
            <button onclick="toggleCart()" class="w-full mt-2 text-gray-400 text-sm">Continue Shopping</button>
        </div>
    </div>

    <div id="track-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden z-50 flex justify-center items-center p-4 text-black">
        <div class="bg-white w-full max-w-md rounded-2xl p-6">
            <h2 class="text-xl font-bold mb-4 text-center">Track Order</h2>
            <input id="track-id-input" type="text" placeholder="ORD1001" class="w-full p-3 border rounded-xl mb-4 uppercase text-center font-bold">
            <button onclick="trackOrder()" class="w-full bg-indigo-600 text-white py-3 rounded-xl font-bold">Check Status</button>
            <div id="track-result" class="mt-4 p-4 bg-indigo-50 rounded-xl hidden text-center">
                <p class="font-bold italic">Status: <span id="status-text" class="text-indigo-700 uppercase">---</span></p>
                <div id="status-msg" class="text-sm mt-2"></div>
            </div>
            <button onclick="showTrackModal()" class="w-full text-gray-400 mt-4 text-xs font-bold underline uppercase">Close</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAeG25EZLmrhfedtBwsak0Fd_2Opsa99_g",
            authDomain: "pankaj-kirana-store-38072.firebaseapp.com",
            projectId: "pankaj-kirana-store-38072",
            storageBucket: "pankaj-kirana-store-38072.firebasestorage.app",
            messagingSenderId: "581034855422",
            appId: "1:581034855422:web:aaf2abecef1c0e7ba60eaf"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const myWhatsApp = "918954998216";

        let currentUser = JSON.parse(localStorage.getItem('pankaj_user')) || null;
        let generatedOTP = null;
        let cart = {};

        const products = [
            { id: 1, name: "Coca Cola 750ml", price: 45, img: "ğŸ¥¤", cat: "Drink" },
            { id: 2, name: "Pepsi 750ml", price: 45, img: "ğŸ¥¤", cat: "Drink" },
            { id: 3, name: "Sprite 750ml", price: 45, img: "ğŸ‹", cat: "Drink" },
            { id: 4, name: "Thums Up 750ml", price: 45, img: "ğŸ¥¤", cat: "Drink" },
            { id: 5, name: "Maaza 600ml", price: 40, img: "ğŸ¥­", cat: "Drink" },
            { id: 6, name: "Sting Energy", price: 20, img: "âš¡", cat: "Drink" },
            { id: 7, name: "Mountain Dew", price: 45, img: "ğŸ", cat: "Drink" },
            { id: 8, name: "Limca 750ml", price: 45, img: "ğŸ¸", cat: "Drink" },
            { id: 9, name: "Frooti Tetra", price: 10, img: "ğŸ§ƒ", cat: "Drink" },
            { id: 10, name: "Red Bull", price: 125, img: "ğŸ‚", cat: "Drink" },
            { id: 11, name: "Fortune Oil 1L", price: 160, img: "ğŸ¶", cat: "Kirana" },
            { id: 12, name: "Aashirvaad Atta 5kg", price: 255, img: "ğŸŒ¾", cat: "Kirana" },
            { id: 13, name: "Tata Salt 1kg", price: 28, img: "ğŸ§‚", cat: "Kirana" },
            { id: 14, name: "Sugar 1kg", price: 45, img: "ğŸ¬", cat: "Kirana" },
            { id: 15, name: "Red Label 250g", price: 145, img: "â˜•", cat: "Kirana" },
            { id: 16, name: "Toor Dal 1kg", price: 170, img: "ğŸ²", cat: "Kirana" },
            { id: 17, name: "Moong Dal 1kg", price: 120, img: "ğŸ²", cat: "Kirana" },
            { id: 18, name: "Basmati Rice 1kg", price: 95, img: "ğŸš", cat: "Kirana" },
            { id: 19, name: "Rajma 1kg", price: 140, img: "ğŸ›", cat: "Kirana" },
            { id: 20, name: "Kabuli Chana 1kg", price: 130, img: "ğŸ›", cat: "Kirana" },
            { id: 21, name: "Poha 1kg", price: 55, img: "ğŸŒ¾", cat: "Kirana" },
            { id: 22, name: "Besan 500g", price: 60, img: "ğŸ¥£", cat: "Kirana" },
            { id: 23, name: "Suji 500g", price: 35, img: "ğŸ¥£", cat: "Kirana" },
            { id: 24, name: "Maida 500g", price: 30, img: "ğŸ¥£", cat: "Kirana" },
            { id: 25, name: "MDH Masala", price: 85, img: "ğŸ“¦", cat: "Kirana" },
            { id: 26, name: "Maggi 12-Pack", price: 160, img: "ğŸœ", cat: "Snacks" },
            { id: 27, name: "Kurkure Masala", price: 10, img: "ğŸ¿", cat: "Snacks" },
            { id: 28, name: "Lays Blue", price: 10, img: "ğŸŸ", cat: "Snacks" },
            { id: 29, name: "Uncle Chips", price: 20, img: "ğŸŸ", cat: "Snacks" },
            { id: 30, name: "Parle-G (Big)", price: 25, img: "ğŸª", cat: "Snacks" },
            { id: 31, name: "Good Day", price: 30, img: "ğŸª", cat: "Snacks" },
            { id: 32, name: "Hide & Seek", price: 35, img: "ğŸª", cat: "Snacks" },
            { id: 33, name: "Marie Gold", price: 10, img: "ğŸª", cat: "Snacks" },
            { id: 34, name: "Haldiram Bhujia", price: 40, img: "ğŸ¥¨", cat: "Snacks" },
            { id: 35, name: "Almond 100g", price: 110, img: "ğŸ¥œ", cat: "Snacks" },
            { id: 36, name: "Kaju 100g", price: 120, img: "ğŸ¥œ", cat: "Snacks" },
            { id: 37, name: "Dairy Milk", price: 40, img: "ğŸ«", cat: "Snacks" },
            { id: 38, name: "KitKat", price: 25, img: "ğŸ«", cat: "Snacks" },
            { id: 39, name: "Ketchup Bottle", price: 120, img: "ğŸ…", cat: "Snacks" },
            { id: 40, name: "Pasta 500g", price: 65, img: "ğŸ", cat: "Snacks" },
            { id: 41, name: "Dettol Soap", price: 35, img: "ğŸ§¼", cat: "Personal" },
            { id: 42, name: "Dove Soap", price: 55, img: "ğŸ§¼", cat: "Personal" },
            { id: 43, name: "Colgate Paste", price: 95, img: "ğŸª¥", cat: "Personal" },
            { id: 44, name: "Clinic Plus", price: 75, img: "ğŸ§´", cat: "Personal" },
            { id: 45, name: "Parachute Oil", price: 40, img: "ğŸ¥¥", cat: "Personal" },
            { id: 46, name: "Surf Excel 1kg", price: 140, img: "ğŸ§º", cat: "Personal" },
            { id: 47, name: "Vim Bar", price: 10, img: "ğŸ‹", cat: "Personal" },
            { id: 48, name: "Harpic Blue", price: 105, img: "ğŸš½", cat: "Personal" },
            { id: 49, name: "Lizol 500ml", price: 115, img: "ğŸ§¹", cat: "Personal" },
            { id: 50, name: "Fair & Lovely", price: 60, img: "âœ¨", cat: "Personal" }
        ];

        // --- AUTH & OTP ---
        function toggleAuthModal() { document.getElementById('auth-modal').classList.toggle('hidden'); }
        function switchAuth(isReg) {
            document.getElementById('login-form').classList.toggle('hidden', isReg);
            document.getElementById('register-form').classList.toggle('hidden', !isReg);
        }

        function sendOTP() {
            const phone = document.getElementById('login-phone').value;
            if(phone.length < 10) { alert("Sahi number dalein!"); return; }
            db.ref('users/' + phone).once('value').then(snap => {
                if(snap.exists()) {
                    generatedOTP = Math.floor(1000 + Math.random() * 9000);
                    alert("DEMO OTP: " + generatedOTP);
                    document.getElementById('phone-input-section').classList.add('hidden');
                    document.getElementById('otp-input-section').classList.remove('hidden');
                } else { alert("You don't have account. Please register yourself."); }
            });
        }

        function verifyOTP() {
            const entered = document.getElementById('login-otp').value;
            if(entered == generatedOTP) {
                const phone = document.getElementById('login-phone').value;
                db.ref('users/' + phone).once('value').then(snap => {
                    loginUser(snap.val());
                    toggleAuthModal();
                });
            } else { alert("Galat OTP!"); }
        }

        function handleRegister() {
            const name = document.getElementById('reg-name').value;
            const phone = document.getElementById('reg-phone').value;
            const addr = document.getElementById('reg-addr').value;
            if(!name || !phone || !addr) { alert("Sab details bharein!"); return; }
            db.ref('users/' + phone).set({ name, phone, address: addr }).then(() => {
                loginUser({ name, phone, address: addr });
                toggleAuthModal();
            });
        }

        function loginUser(user) {
            currentUser = user;
            localStorage.setItem('pankaj_user', JSON.stringify(user));
            updateUI();
        }

        function updateUI() {
            if(currentUser) {
                document.getElementById('user-welcome').innerText = "Welcome, " + currentUser.name.split(' ')[0];
                document.getElementById('auth-btn').innerText = "Logout";
                document.getElementById('auth-btn').onclick = () => { localStorage.clear(); location.reload(); };
                
                document.getElementById('disp-name').innerText = currentUser.name;
                document.getElementById('disp-numbr').innerText = "+91 " + currentUser.phone;
                document.getElementById('disp-addr').innerText = currentUser.address;

                document.getElementById('cust-name').value = currentUser.name;
                document.getElementById('cust-numbr').value = currentUser.phone;
                document.getElementById('cust-addr').value = currentUser.address;
            }
        }

        function toggleAddressEdit(show) {
            document.getElementById('address-display-box').classList.toggle('hidden', show);
            document.getElementById('address-edit-form').classList.toggle('hidden', !show);
            if(!show) {
                document.getElementById('disp-name').innerText = document.getElementById('cust-name').value;
                document.getElementById('disp-numbr').innerText = document.getElementById('cust-numbr').value;
                document.getElementById('disp-addr').innerText = document.getElementById('cust-addr').value;
            }
        }

        // --- CORE LOGIC ---
        function renderProducts(filter = 'All') {
            const list = document.getElementById('product-list');
            const filtered = filter === 'All' ? products : products.filter(p => p.cat === filter);
            list.innerHTML = filtered.map(p => `
                <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 text-center flex flex-col justify-between">
                    <div>
                        <div class="text-4xl mb-2">${p.img}</div>
                        <h3 class="font-bold text-gray-800 text-xs h-8 overflow-hidden">${p.name}</h3>
                        <p class="text-indigo-600 font-bold">â‚¹${p.price}</p>
                    </div>
                    <button onclick="addToCart(${p.id}, event)" class="mt-3 w-full bg-indigo-50 text-indigo-700 py-2 rounded-xl font-bold border border-indigo-100">+ Add</button>
                </div>
            `).join('');
        }

        function filterProducts(cat, btn) {
            document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active-cat'));
            btn.classList.add('active-cat');
            renderProducts(cat);
        }

        function addToCart(id, event) {
            if (cart[id]) cart[id].qty++; 
            else { 
                const p = products.find(i => i.id === id);
                cart[id] = { ...p, qty: 1 };
            }
            updateCart();
            const btn = event.target;
            btn.innerText = "âœ“ Added";
            setTimeout(() => { btn.innerText = "+ Add"; }, 800);
        }

        function updateCart() {
            let total = 0, count = 0;
            const itemsDiv = document.getElementById('cart-items');
            itemsDiv.innerHTML = "";
            Object.values(cart).forEach(item => {
                total += item.price * item.qty; count += item.qty;
                itemsDiv.innerHTML += `<div class="flex justify-between items-center text-sm py-2 border-b"><div class="w-1/2"><b>${item.name}</b><br><span class="text-xs text-gray-400">â‚¹${item.price}</span></div><div class="flex items-center gap-2"><button onclick="changeQty(${item.id}, -1)" class="w-6 h-6 bg-gray-100 rounded-full font-black">-</button><span class="w-4 text-center font-bold">${item.qty}</span><button onclick="changeQty(${item.id}, 1)" class="w-6 h-6 bg-gray-100 rounded-full font-black">+</button></div></div>`;
            });
            document.getElementById('cart-count').innerText = count;
            document.getElementById('cart-total').innerText = total;
        }

        function changeQty(id, delta) {
            cart[id].qty += delta;
            if (cart[id].qty <= 0) delete cart[id];
            updateCart();
        }

        function toggleCart() { 
            if(!currentUser) { alert("Please Login First!"); toggleAuthModal(); return; }
            document.getElementById('cart-modal').classList.toggle('hidden'); 
            updateUI(); 
        }

        function placeOrder() {
            const name = document.getElementById('cust-name').value;
            const addr = document.getElementById('cust-addr').value;
            const phone = document.getElementById('cust-numbr').value;
            const rmrks = document.getElementById('cust-rmrks').value;
            const total = document.getElementById('cart-total').innerText;
            const cartItems = Object.values(cart);
            if(!name || !addr || cartItems.length === 0) { alert("Details ya cart empty hai!"); return; }

            db.ref('last_order_id').transaction(v => (v || 1000) + 1, (err, comm, snap) => {
                if(comm) {
                    const id = "ORD" + snap.val();
                    const orderData = { id, name, address: addr, phone, items: cartItems, total, status: "Pending" };
                    db.ref('orders/' + id).set(orderData).then(() => {
                        let str = ""; cartItems.forEach(i => str += `- ${i.name} [x${i.qty}]%0A`);
                        const msg = `*ORDER: ${id}*%0A*Customer:* ${name}%0A*Phone:* ${phone}%0A*Address:* ${addr}%0A*Total:* â‚¹${total}%0A%0A*Items:*%0A${str}%0A*Note:* ${rmrks}`;
                        window.location.href = `whatsapp://send?phone=${myWhatsApp}&text=${msg}`;
                    });
                }
            });
        }

        function showTrackModal() { document.getElementById('track-modal').classList.toggle('hidden'); }
        function trackOrder() {
            const id = document.getElementById('track-id-input').value.toUpperCase();
            db.ref('orders/' + id).once('value').then(snap => {
                const res = document.getElementById('track-result');
                res.classList.remove('hidden');
                if(snap.exists()) {
                    document.getElementById('status-text').innerText = snap.val().status;
                    document.getElementById('status-msg').innerText = " ";
                } else { alert("Order ID galat hai!"); }
            });
        }

        renderProducts();
        updateUI();
    </script>
</body>
</html>

